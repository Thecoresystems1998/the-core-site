<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>THE CORE.</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ================= TOP BAR ================= -->

<div class="top-bar">

  <div class="search-wrap">
    <span class="search-icon">⌕</span>
    <input class="search-input" placeholder="search archive">
  </div>

  <img src="images/logo-horizontal.png" class="top-logo">

  <div class="top-right" onclick="openReservePanel()">ACCESS</div>

</div>

<!-- ================= HERO CANVAS ================= -->

<section class="hero-canvas" id="heroCanvas">

  <img src="images/landing-hero.png" class="hero-bg" id="heroBg">

  <div class="hero-overlay">
    <button class="hero-cta" onclick="openReservePanel()">
      RESERVE ENTRY
    </button>
  </div>

</section>

<!-- ================= PRODUCT ================= -->

<section class="product" id="productSection">

  <img src="images/hero.jpg" class="product-img">

  <button class="preorder-btn">
    PRE-ORDER TOWEL
  </button>

</section>

<!-- ================= STATUS ================= -->

<section class="status">

  <div class="status-box">

    <div class="status-title">
      OBJECT STATUS
    </div>

    <div class="status-line">NFC — UNACTIVATED</div>
    <div class="status-line">ARCHIVE — LOCKED</div>
    <div class="status-line">MEMBER — REQUIRED</div>

  </div>

</section>

<!-- ================= MEMBERS ================= -->

<section class="members">

  <div class="members-title">
    MEMBERSPACE PREVIEW
  </div>

  <div class="member-grid">
    <div class="tile">ARCHIVE</div>
    <div class="tile">OBJECT</div>
    <div class="tile">STATUS</div>
    <div class="tile">ACCESS</div>
    <div class="tile">REGISTRY</div>
    <div class="tile">CORE</div>
  </div>

</section>

<!-- ================= BOTTOM BAR ================= -->

<div class="bottom-bar" id="bottomBar">
DISCIPLINE • DANGER • FOCUS
</div>

<!-- ================= RESERVE PANEL ================= -->

<div class="reserve-overlay" id="reservePanel">

  <div class="reserve-box">

    <div class="reserve-title">
      SYSTEM RESERVATION
    </div>

    <input id="reserveEmail" class="reserve-input" placeholder="email">

    <button onclick="submitReserve()" class="reserve-confirm">
      CONFIRM
    </button>

    <div id="reserveStatus" class="reserve-status"></div>

    <div class="reserve-close" onclick="closeReservePanel()">×</div>

  </div>

</div>

<!-- ================= SCRIPT ================= -->

<script>

const topBar = document.querySelector(".top-bar");
const bottomBar = document.getElementById("bottomBar");
const heroBg = document.getElementById("heroBg");
const heroCanvas = document.getElementById("heroCanvas");
const productSection = document.getElementById("productSection");

/* reserve panel */

function openReservePanel(){
  reservePanel.classList.add("active");
}

function closeReservePanel(){
  reservePanel.classList.remove("active");
}

/* reserve api */

async function submitReserve(){

  const email = reserveEmail.value;
  reserveStatus.innerText = "PROCESSING";

  try {

    const r = await fetch("http://localhost:4000/reserve",{
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body: JSON.stringify({ email })
    });

    const data = await r.json();

    if(data.status==="reserved"){
      reserveStatus.innerText =
        "RESERVED — POSITION " + data.position;
    } else {
      reserveStatus.innerText = "FAILED";
    }

  } catch {
    reserveStatus.innerText = "SERVER ERROR";
  }
}

/* ===== cinematic bars ===== */

let lastScroll = 0;

window.addEventListener("scroll", () => {

  const y = window.scrollY;

  if(y > 80 && y > lastScroll){
    topBar.classList.add("bar-hidden");
    bottomBar.classList.add("bottom-hidden");
  } else {
    topBar.classList.remove("bar-hidden");
    bottomBar.classList.remove("bottom-hidden");
  }

  lastScroll = y;

  /* hero parallax */

  const depth = y * 0.06;
  heroBg.style.transform =
    `scale(${1 + depth/100}) translateY(${y*0.15}px)`;

  /* CTA fade */

  const heroHeight = heroCanvas.offsetHeight;
  const fade = 1 - (y / heroHeight)*1.2;

  document.querySelector(".hero-cta").style.opacity =
    Math.max(fade, 0);

  /* product reveal */

  const rect = productSection.getBoundingClientRect();

  if(rect.top < window.innerHeight * 0.8){
    productSection.classList.add("reveal");
  }

});

/* cursor reveal */

document.addEventListener("mousemove", (e) => {

  if(e.clientY < 80){
    topBar.classList.remove("bar-hidden");
  }

  if(window.innerHeight - e.clientY < 80){
    bottomBar.classList.remove("bottom-hidden");
  }

});

</script>

</body>
</html>