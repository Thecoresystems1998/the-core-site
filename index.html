<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>THE CORE.</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- SYSTEM HEADER -->

<div class="system-bar">
  <div class="sys-left">SEARCH</div>
  <div class="sys-center">
    <img src="images/logo-horizontal.png" class="sys-logo">
  </div>
  <div class="sys-right" onclick="openReservePanel()">ACCESS</div>
</div>

<!-- HERO -->

<section class="hero">

  <div class="grain"></div>

  <img src="images/logo-horizontal.png" class="hero-logo">

  <div class="hero-sub">
    DISCIPLINE • DANGER • FOCUS
  </div>

</section>

<!-- CINEMATIC SECTION -->

<section class="cinematic">

  <div class="cinematic-inner">

    <img src="images/hero.jpg" class="cinematic-img">

    <div class="cinematic-copy">
      REGISTERED OBJECT  
      LIMITED ENTRY  
      SYSTEM ACCESS
    </div>

    <button class="reserve-btn" onclick="openReservePanel()">
      RESERVE ENTRY
    </button>

  </div>

</section>

<!-- RESERVE PANEL -->

<div class="reserve-overlay" id="reservePanel">

  <div class="reserve-box">

    <div class="reserve-title">
      SYSTEM RESERVATION
    </div>

    <input id="reserveEmail" class="reserve-input" placeholder="email">

    <button class="reserve-confirm" onclick="submitReserve()">
      CONFIRM
    </button>

    <div id="reserveStatus" class="reserve-status"></div>

    <div class="reserve-close" onclick="closeReservePanel()">×</div>

  </div>

</div>

<script>

function openReservePanel(){
  document.getElementById("reservePanel").classList.add("active");
}

function closeReservePanel(){
  document.getElementById("reservePanel").classList.remove("active");
}

async function submitReserve(){

  const email = document.getElementById("reserveEmail").value;
  const status = document.getElementById("reserveStatus");

  status.innerText = "PROCESSING";

  try {

    const r = await fetch("http://localhost:4000/reserve", {
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body: JSON.stringify({ email })
    });

    const data = await r.json();

    if(data.status === "reserved"){
      status.innerText = "RESERVED — POSITION " + data.position;
    } else {
      status.innerText = "FAILED";
    }

  } catch(e){
    status.innerText = "SERVER ERROR";
  }

}

</script>

</body>
</html>